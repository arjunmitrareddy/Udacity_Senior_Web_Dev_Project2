{"version":3,"sources":["Server.js"],"names":["_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","Object","defineProperty","exports","value","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","prototype","_express","require","_express2","_zlib","_zlib2","_compression","_compression2","_http","_http2","_net","_net2","_ws","_templatesIndex","_templatesIndex2","_templatesInfoPanel","_templatesInfoPanel2","compressor","flush","Z_PARTIAL_FLUSH","Server","port","this","_app","_port","_serverUp","_appServerUp","_messages","_sockets","_appServer","createServer","staticOptions","maxAge","use","get","req","res","send","extraCss","scripts","content","_this","listen","_","console","log","module"],"mappings":"AAAA,YAQA,SAASA,wBAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAAWF,GAEzF,QAASG,iBAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCARhHC,OAAOC,eAAeC,QAAS,cAC3BC,OAAO,GAGX,IAAIC,cAAe,WAAe,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIC,GAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CAAE,GAAIE,GAAaH,EAAMC,EAAIE,GAAWC,WAAaD,EAAWC,aAAc,EAAOD,EAAWE,cAAe,EAAU,SAAWF,KAAYA,EAAWG,UAAW,GAAMb,OAAOC,eAAeK,EAAQI,EAAWI,IAAKJ,IAAiB,MAAO,UAAUZ,EAAaiB,EAAYC,GAAiJ,MAA9HD,IAAYV,EAAiBP,EAAYmB,UAAWF,GAAiBC,GAAaX,EAAiBP,EAAakB,GAAqBlB,MAM7hBoB,SAAWC,QAZK,WAchBC,UAAY5B,uBAAuB0B,UAEnCG,MAAQF,QAfK,QAiBbG,OAAS9B,uBAAuB6B,OAEhCE,aAAeJ,QAlBK,eAoBpBK,cAAgBhC,uBAAuB+B,cAEvCE,MAAQN,QArBK,QAuBbO,OAASlC,uBAAuBiC,OAIhCE,KAAOR,QA1BK,OA4BZS,MAAQpC,uBAAuBmC,MAK/BE,IAAMV,QA/B8B,MAiCpCW,gBAAkBX,QAhCI,qBAkCtBY,iBAAmBvC,uBAAuBsC,iBAE1CE,oBAAsBb,QAnCI,yBAqC1Bc,qBAAuBzC,uBAAuBwC,qBAlC5CE,YAAa,EAAAV,cAAA,aAChBW,MAAOb,OAAA,WAAKc,kBAGMC,OAAM,WAEZ,QAFMA,GAELC,GAoCR1C,gBAAgB2C,KAtCHF,GAGbE,KAAKC,MAAO,EAAApB,UAAA,cACZmB,KAAKE,MAAQH,EACbC,KAAKG,WAAY,EACjBH,KAAKI,cAAe,EACpBJ,KAAKK,aACLL,KAAKM,YAELN,KAAKO,WAAapB,OAAA,WAAKqB,aAAaR,KAAKC,KAKzC,IAAMQ,IACFC,OAAQ,EAGZV,MAAKC,KAAKU,IAAI,MAAO9B,UAAA,WAAA,UAAe,eAAgB4B,IACpDT,KAAKC,KAAKU,IAAI,OAAQ9B,UAAA,WAAA,UAAe,gBAAiB4B,IACtDT,KAAKC,KAAKU,IAAI,QAAS9B,UAAA,WAAA,UAAe,iBAAkB4B,IACxDT,KAAKC,KAAKU,IAAI,WAAY9B,UAAA,WAAA,UAAe,oBAAqB4B,IAC9DT,KAAKC,KAAKU,IAAI,oBAAqB9B,UAAA,WAAA,UAAe,6BAA8B4B,IAChFT,KAAKC,KAAKU,IAAI,wBAAyB9B,UAAA,WAAA,UAAe,iCAAkC4B,IACxFT,KAAKC,KAAKU,IAAI,SAAU9B,UAAA,WAAA,UAAe,oBACvCmB,KAAKC,KAAKU,IAAI,QAAS9B,UAAA,WAAA,UAAe,iBAAkB4B,IAExDT,KAAKC,KAAKW,IAAI,IAAK,SAACC,EAAKC,GACrBA,EAAIC,MAAK,EAAAvB,iBAAA,aACLwB,SAAU,+CACVC,SACI,4CACA,sCAEJC,SAAU,EAAAxB,qBAAA,mBAkDtB,MAdA7B,cAvEiBiC,IAwEbvB,IAAK,UACLX,MAhCG,WAiCC,GAAIuD,GAAQnB,IAhCXA,MAAKI,eACNJ,KAAKO,WAAWa,OAAOpB,KAAKE,MAAO,SAAAmB,GAC/BC,QAAQC,IAAI,iCAAmCJ,EAAKjB,SAExDF,KAAKI,cAAe,OA9CXN,IAwFrBnC,SAAQ,WAxFamC,OAyFrB0B,OAAO7D,QAAUA,QAAQ","file":"Server.js","sourcesContent":["import express from 'express';\r\nimport zlib from 'zlib';\r\nimport compression from 'compression';\r\nimport http from 'http'; //for http server\r\nimport net from 'net'; //for tcp/local server\r\n//import url from 'url';\r\nimport {Server as WebSocketServer} from 'ws';\r\nimport indexTemplate from './templates/index';\r\nimport infoPanelTemplate from './templates/infoPanel';\r\n\r\n\r\nconst compressor = compression({\r\n   flush: zlib.Z_PARTIAL_FLUSH\r\n});\r\n\r\nexport default class Server {\r\n\r\n    constructor(port) {\r\n        this._app = express();\r\n        this._port = port;\r\n        this._serverUp = false;\r\n        this._appServerUp = false;\r\n        this._messages = [];\r\n        this._sockets = [];\r\n\r\n        this._appServer = http.createServer(this._app);\r\n\r\n\r\n\r\n\r\n        const staticOptions = {\r\n            maxAge: 0\r\n        };\r\n\r\n        this._app.use('/js', express.static('../public/js', staticOptions));\r\n        this._app.use('/css', express.static('../public/css', staticOptions));\r\n        this._app.use('/imgs', express.static('../public/imgs', staticOptions));\r\n        this._app.use('/avatars', express.static('../public/avatars', staticOptions));\r\n        this._app.use('/serviceWorker.js', express.static('../public/serviceWorker.js', staticOptions));\r\n        this._app.use('/serviceWorker.js.map', express.static('../public/serviceWorker.js.map', staticOptions));\r\n        this._app.use('/fonts', express.static('../public/fonts'));\r\n        this._app.use('/gtfs', express.static('../public/gtfs', staticOptions));\r\n\r\n        this._app.get('/', (req, res) => {\r\n            res.send(indexTemplate({\r\n                extraCss: '<link rel=\"stylesheet\" href=\"/css/lib.css\"/>',\r\n                scripts: [\r\n                    '<script src=\"/js/main.js\" defer></script>',\r\n                    '<script src=\"/js/lib.js\"></script>'\r\n                ],\r\n                content : infoPanelTemplate()\r\n            }))\r\n        });\r\n\r\n    }\r\n\r\n    _listen() {\r\n        if (!this._appServerUp) {\r\n            this._appServer.listen(this._port, _ => {\r\n                console.log(\"Server Listening on localhost:\" + this._port);\r\n            });\r\n            this._appServerUp = true;\r\n        }\r\n\r\n    }\r\n}"],"sourceRoot":"/source/"}